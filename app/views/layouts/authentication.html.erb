<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "MerchantDex" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Merchant">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>

    <style>
      body { font-family: 'Outfit', system-ui, -apple-system, sans-serif; }
    </style>
  </head>

  <body class="bg-white min-h-screen" data-turbo="true">
    <!-- Flash Messages (only show notice/success, alerts are shown inline in forms) -->
    <% if flash[:notice] || flash[:success] %>
      <div class="fixed top-4 right-4 z-50 space-y-2" id="flash-messages">
        <% flash.each do |type, message| %>
          <% next if type.to_sym == :alert || type.to_sym == :error %>
          <% bg_class = case type.to_sym
             when :notice then "bg-slate-800 border-slate-600 text-white"
             when :success then "bg-green-500/20 border-green-400 text-white"
             else "bg-slate-800 border-slate-600 text-white"
             end %>
          <div class="<%= bg_class %> border px-4 py-3 rounded-lg shadow-lg flex items-center gap-3 max-w-sm text-sm" role="alert">
            <span><%= message %></span>
            <button onclick="this.parentElement.remove()" class="ml-auto hover:opacity-70 text-white">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </button>
          </div>
        <% end %>
      </div>
    <% end %>

    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 bg-white border-b border-slate-200 z-40">
      <div class="max-w-6xl mx-auto px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <%= link_to root_path, class: "flex items-center gap-2", data: { turbo: false } do %>
            <div class="w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center">
              <span class="text-white font-bold text-sm">M</span>
            </div>
            <span class="text-lg font-semibold text-slate-900">MerchantDex</span>
          <% end %>
        </div>
      </div>
    </nav>

    <main class="min-h-screen flex items-center justify-center pt-24 pb-12">
      <div style="width: 100%; max-width: 480px; padding: 0 24px;">
        <%= yield %>
      </div>
    </main>

    <script>
      setTimeout(() => {
        const flashMessages = document.getElementById('flash-messages');
        if (flashMessages) {
          flashMessages.querySelectorAll('[role="alert"]').forEach(alert => {
            alert.style.transition = 'opacity 0.3s ease-out';
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 300);
          });
        }
      }, 4000);
    </script>
  </body>
</html>
